---
title: "eda"
author: "Yooby"
date: "4/19/2022"
output: html_document
---

```{r setup, include=FALSE}
source(here::here("script/setup.R"))
```

```{r, eval=FALSE, include=FALSE}
setwd(here::here("data/"))
GermanCredit <- read_csv("GermanCreditClean.csv")
```

## Exploratory Data Analysis

```{r, eval=FALSE}
# Distribution of the numerical columns, i.e. duration, amount, install_rate, age, num_credits, num_dependence

p.duration <- GermanCredit %>% 
  ggplot(aes(x = DURATION)) +
  geom_histogram(binwidth = 1)

p.duration

# Not a lot to say about the duration of the credits. It varies a lot.

p.amount <- GermanCredit %>% 
  ggplot(aes(x = AMOUNT)) +
  geom_histogram(binwidth = 1000)

p.amount

# Relatively small amount, less than 5'000

p.install_rate <- GermanCredit %>% 
  ggplot(aes(x = INSTALL_RATE)) +
  geom_histogram(binwidth = 1)

p.install_rate

# Installment rate (in other words, repayment rate) is more around 4%

p.age <- GermanCredit %>% 
  ggplot(aes(x = AGE)) +
  geom_histogram(binwidth = 1)

p.age

# It is skewed, the younger, the better 

p.num_credits <- GermanCredit %>% 
  ggplot(aes(x = NUM_CREDITS)) +
  geom_histogram(binwidth = 1)

p.num_credits

# The less the better, 1 to 3

p.num_dependents <- GermanCredit %>% 
  ggplot(aes(x = NUM_DEPENDENTS)) +
  geom_histogram(binwidth = 1)

p.num_dependents

# Mostly one dependent
```

```{r}
# Link between the amount for the credit and the credit history of the applicant
# 0 means no credits taken, 1: all credits at this bank paid back duly, 
# 2: existing credits paid back duly till now, 3: delay in paying off in the past
# 4: critical account

p.amount_history <- GermanCredit %>% 
  ggplot(aes(x = AMOUNT, fill = HISTORY)) +
  geom_histogram(binwidth = 1000)

p.amount_history

# It's not surprising, when credits are paid, the more they give.

p.amount_chk_account <- GermanCredit %>% 
  ggplot(aes(x = AMOUNT, fill = CHK_ACCT)) +
  geom_histogram(binwidth = 1000)

p.amount_chk_account
```

```{r}
# let's check if old people have basically more credit than young people
mean_yes<-mean(YES_GC$AGE)
mean_yes

mean_no<-mean(NO_GC$AGE)
mean_no

# age does not seem to be a key criterion 
```


```{r}
# comparison of the credit amount  asked 

comp_credits <- boxplot(NO_GC$AMOUNT, YES_GC$AMOUNT,
        horizontal=TRUE,
        names=c("Refused", "Accepted"),
        col=c("light grey","dark grey"),
        xlab="Credit amount",
        main="Comparison of the credit amount asked by the person")

comp_credits # refused person asked for a bigger amount (a bit abvi)

```

```{r}
# correlation matrix

#head(YES_GC)
#corgc <- cor(GermanCredit)
#corgc

library(GGally)

#creation of a new dataset
cordata_fin <- GermanCredit[, c("CHK_ACCT", "HISTORY", "AMOUNT", "SAV_ACCT", "NUM_CREDITS", "RESPONSE") ] 
ggpairs(cordata_fin, title="Correlogram on financial data")

cordata_own <- GermanCredit[, c("NEW_CAR", "USED_CAR", "FURNITURE", "RADIO/TV", "RESPONSE") ]
ggpairs(cordata_own, title="Correlogram on owned products data")

cordata_pro <- GermanCredit[, c("JOB", "EDUCATION", "RETRAINING", "EMPLOYMENT", "RESPONSE") ] 
ggpairs(cordata_pro, title="Correlogram on professional data")

cordata_immo <- GermanCredit[, c("INSTALL_RATE", "REAL_ESTATE", "PRESENT_RESIDENT", "PROP_UNKN_NONE", "RENT", "OWN_RES", "RESPONSE") ]
ggpairs(cordata_immo, title="Correlogram on real estate data")

cordata_demo <- GermanCredit[, c("MALE_DIV", "MALE_SINGLE", "MALE_MAR_WID", "AGE", "FOREIGN", "RESPONSE") ] 
ggpairs(cordata_demo, title="Correlogram on demographic data")

#cor<-ggpairs(GermanCredit, title="correlogram with ggpairs()") 


```

```{r}
# create an average profile of yes person

# remove OBS column
Yes_profil<- select(YES_GC, CHK_ACCT, DURATION, HISTORY, NEW_CAR, USED_CAR, FURNITURE, RADIO.TV, EDUCATION, RETRAINING, AMOUNT, SAV_ACCT, EMPLOYMENT, INSTALL_RATE, MALE_DIV, MALE_SINGLE, MALE_MAR_or_WID, CO.APPLICANT, GUARANTOR, PRESENT_RESIDENT, REAL_ESTATE, PROP_UNKN_NONE, AGE, OTHER_INSTALL, RENT, OWN_RES, NUM_CREDITS, JOB, NUM_DEPENDENTS, TELEPHONE, FOREIGN)

# take the mean of each column
Yes_profil <- summarize_all(Yes_profil, mean)

# transform table in matrix
#Yes_profil <- data.frame(Yes_profil)
#Yes_profil <- apply(as.matrix.noquote(Yes_profil),2,as.numeric)

# show matrix through lolipop plot 
Yes_profil <- data.frame(
  x=c('CHK_ACCT', 'DURATION', 'HISTORY', 'NEW_CAR', 'USED_CAR', 'FURNITURE', 'RADIO.TV', 'EDUCATION', 'RETRAINING', 'AMOUNT', 'SAV_ACCT', 'EMPLOYMENT', 'INSTALL_RATE', 'MALE_DIV', 'MALE_SINGLE', 'MALE_MAR_or_WID', 'CO.APPLICANT', 'GUARANTOR', 'PRESENT_RESIDENT', 'REAL_ESTATE', 'PROP_UNKN_NONE', 'AGE', 'OTHER_INSTALL', 'RENT', 'OWN_RES', 'NUM_CREDITS', 'JOB', 'NUM_DEPENDENTS', 'TELEPHONE', 'FOREIGN'),
  y=abs(rnorm(30))
)

graph_yes_profil <- ggplot(Yes_profil, aes(x=x, y=y)) +
  geom_segment( aes(x=x, xend=x, y=0, yend=y), color="skyblue") +
  geom_point( color="blue", size=4, alpha=0.6) +
  labs(
  title = "Mean of a YES profils",
  y = "Variables name", x = "Value"
)+
  theme_light() +
  coord_flip() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank() 
)

graph_yes_profil

#barplot(prop.table(Yes_profil) * 100, horiz=TRUE, main = "Relative frequency (%)", col = rainbow(3))
```

